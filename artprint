#include "Uart.h"

// Создаем объект SERCOM для SERCOM5
SERCOM sercom5 = SERCOM(SERCOM5);

// Создаем объект UART для SERCOM5
Uart uart(&sercom5, PIN_PA20, PIN_PA21, SERCOM_RX_PAD_3, UART_TX_PAD_2);

// Обработчик прерываний для SERCOM5
void SERCOM5_Handler() {
    uart.IrqHandler();  // Обработчик прерываний для UART
}

// Функция для создания задержки
void delay(uint32_t ms) {
    for (volatile uint32_t i = 0; i < ms * 1000; i++);
}

int main(void) {
    // Инициализация системы
    SystemInit();

    // Инициализация UART на скорости 9600 бод
    uart.begin(9600);

    // Переменная-счетчик
    uint8_t counter = 1;

    // Основной цикл программы
    while (1) {
        // Преобразуем счетчик в строку
        char buffer[4];  // Буфер для хранения строки (например, "1\r\n", "10\r\n")
        int len;

        if (counter < 10) {
            len = 3;  // Однозначное число + символ возврата каретки + символ новой строки
            buffer[0] = '0' + counter;  // Преобразуем число в символ
            buffer[1] = '\r';  // Символ возврата каретки
            buffer[2] = '\n';  // Символ новой строки
        } else {
            len = 4;  // Двузначное число + символ возврата каретки + символ новой строки
            buffer[0] = '0' + (counter / 10);  // Первая цифра (десятки)
            buffer[1] = '0' + (counter % 10);  // Вторая цифра (единицы)
            buffer[2] = '\r';  // Символ возврата каретки
            buffer[3] = '\n';  // Символ новой строки
        }

        // Отправляем строку через UART
        uart.write((uint8_t*)buffer, len);

        // Увеличиваем счетчик
        counter++;

        // Сбрасываем счетчик, если он достиг 11
        if (counter > 10) {
            counter = 1;
        }

        // Задержка 1 секунда
        delay(1000);  // Используем функцию задержки
    }

    return 0;  // Программа никогда не дойдет до этой строки
}
